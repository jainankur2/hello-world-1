pipeline {
      agent any
    stages{
        stage('Build artifact'){
            steps{
               sh label: 'compile-hello-world', script: 'mvn -B -f pom.xml clean install'
            }
        }
          
        stage('Build Image'){
            steps{
               sh 'docker build -t jainankur2/loylogic:${BUILD_NUMBER} .'
            }
        }
           
        stage('Publish Image'){
            steps{
               withCredentials([string(credentialsId: 'dockerhub-pwd', variable: 'dockerhubPwd')]) {
                  sh 'docker login --username jainankur2 --password ${dockerhubPwd}'
                }
               sh 'docker push jainankur2/loylogic:${BUILD_NUMBER}'
            }
            post{
               success{
                  sh 'docker rmi -f jainankur2/loylogic:${BUILD_NUMBER}'
               }
            }
        }
    }
}
